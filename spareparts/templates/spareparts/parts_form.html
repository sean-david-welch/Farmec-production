{% extends 'main.html' %}
{% load static %}
{% block content %}

<section id="form">
    <form class="form" method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        {% if messages %}
        <ul class="messages">
            {% for message in messages %}
            <li{% if message.tags %} class="{{ message.tags }}" {% endif %}>{{ message }}</li>
                {% endfor %}
        </ul>
        {% endif %}
        {% for field in form %}
        <div class="input">
            <h1>{{field.label}}:</h1>
            <p>{{field}}</p>
        </div>
        {% endfor %}
        <div id="form-container">
            {{formset.management_form}}
            {% for field in formset %}
            <div class="input">
                <h1>Parts Required:</h1>
                <p>{{field}}</p>
            </div>
        </div>
        <div id="empty-form" class="input" style="display: none;">
            <p>{{formset.empty_form}}</p>
        </div>
        {% endfor %}
        <button class="btn btn-primary" id="add-more" type="button">Add More</button>
        <input class="submit btn btn-primary" type="submit"></input>
    </form>
</section>

<script>
    const addMoreBtn = document.getElementById('add-more');
    const formContainer = document.getElementById('form-container');
    const emptyForm = document.getElementById('empty-form');
    const totalNewForms = document.getElementById('id_partsrequired_set-TOTAL_FORMS');

    addMoreBtn.addEventListener('click', addNewForm);

    function addNewForm() {
        // Clone the empty form
        const newForm = emptyForm.cloneNode(true);
        newForm.style.display = 'block';

        // Update the form's index to match the next form in the formset
        const formIndex = parseInt(totalNewForms.value);
        const formId = `id_partsrequired_set-${formIndex}-`;
        const formInputs = newForm.getElementsByTagName('input');
        for (let i = 0; i < formInputs.length; i++) {
            formInputs[i].id = formInputs[i].id.replace('__prefix__', formIndex);
            formInputs[i].name = formInputs[i].name.replace('__prefix__', formIndex);
        }

        // Add the new form to the form container
        formContainer.appendChild(newForm);

        // Update the total number of forms
        totalNewForms.value = formIndex + 1;
    }
</script>

{% endblock content %}